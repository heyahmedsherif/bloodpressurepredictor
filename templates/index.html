<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ©º Health Prediction Suite - Camera Based Analysis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-heartbeat me-2"></i>
                Health Prediction Suite
            </a>
            <span class="navbar-text">
                <i class="fas fa-video me-1"></i>
                Camera-Based Analysis
            </span>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Left Panel - Camera Controls -->
            <div class="col-lg-6">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-camera me-2"></i>
                            Camera Interface
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Camera Video Display -->
                        <div class="camera-container mb-3">
                            <video id="cameraVideo" autoplay playsinline muted class="w-100 rounded"></video>
                            <canvas id="processedCanvas" class="w-100 rounded" style="display: none;"></canvas>
                            <div id="cameraStatus" class="camera-overlay">
                                <i class="fas fa-video-slash"></i>
                                <p>Click "Start Camera" to begin</p>
                            </div>
                        </div>

                        <!-- Camera Controls -->
                        <div class="camera-controls">
                            <div class="row g-2">
                                <div class="col-6">
                                    <button id="startCameraBtn" class="btn btn-success w-100">
                                        <i class="fas fa-video me-1"></i>
                                        Start Camera
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button id="stopCameraBtn" class="btn btn-secondary w-100" disabled>
                                        <i class="fas fa-video-slash me-1"></i>
                                        Stop Camera
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row g-2 mt-2">
                                <div class="col-12">
                                    <button id="startRecordingBtn" class="btn btn-danger w-100" disabled>
                                        <i class="fas fa-record-vinyl me-1"></i>
                                        Start Recording & PPG Analysis
                                    </button>
                                </div>
                            </div>

                            <div id="recordingControls" style="display: none;" class="mt-3">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <button id="stopRecordingBtn" class="btn btn-warning w-100">
                                            <i class="fas fa-stop me-1"></i>
                                            Stop Recording
                                        </button>
                                    </div>
                                    <div class="col-6">
                                        <button id="analyzeBtn" class="btn btn-primary w-100" disabled>
                                            <i class="fas fa-analytics me-1"></i>
                                            Analyze Results
                                        </button>
                                    </div>
                                </div>

                                <!-- Recording Progress -->
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="text-muted">Recording Progress</span>
                                        <span id="frameCounter" class="badge bg-primary">0 / 150 frames</span>
                                    </div>
                                    <div class="progress">
                                        <div id="recordingProgress" class="progress-bar progress-bar-striped progress-bar-animated" 
                                             role="progressbar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Patient Info & Results -->
            <div class="col-lg-6">
                <!-- Patient Demographics -->
                <div class="card shadow mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-user me-2"></i>
                            Patient Demographics
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="patientAge" class="form-label">Age</label>
                                <input type="number" class="form-control" id="patientAge" value="47" min="18" max="100">
                            </div>
                            <div class="col-md-6">
                                <label for="patientGender" class="form-label">Gender</label>
                                <select class="form-select" id="patientGender">
                                    <option value="Female">Female</option>
                                    <option value="Male" selected>Male</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="patientHeight" class="form-label">Height (cm)</label>
                                <input type="number" class="form-control" id="patientHeight" value="173" min="120" max="220">
                            </div>
                            <div class="col-md-6">
                                <label for="patientWeight" class="form-label">Weight (kg)</label>
                                <input type="number" class="form-control" id="patientWeight" value="83" min="30" max="200">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PPG Results -->
                <div id="ppgResults" class="card shadow mb-4" style="display: none;">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-heartbeat me-2"></i>
                            PPG Analysis Results
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3 text-center">
                            <div class="col-md-4">
                                <div class="metric-card">
                                    <i class="fas fa-heartbeat text-danger fs-2"></i>
                                    <h4 id="heartRate" class="mt-2">-- BPM</h4>
                                    <small class="text-muted">Heart Rate</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="metric-card">
                                    <i class="fas fa-video text-primary fs-2"></i>
                                    <h4 id="framesProcessed" class="mt-2">--</h4>
                                    <small class="text-muted">Frames Processed</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="metric-card">
                                    <i class="fas fa-clock text-info fs-2"></i>
                                    <h4 id="recordingDuration" class="mt-2">-- s</h4>
                                    <small class="text-muted">Duration</small>
                                </div>
                            </div>
                        </div>

                        <!-- PPG Signal Chart -->
                        <div class="mt-4">
                            <canvas id="ppgChart" width="400" height="200"></canvas>
                        </div>

                        <div class="mt-3 text-center">
                            <button id="predictHealthBtn" class="btn btn-primary btn-lg">
                                <i class="fas fa-analytics me-2"></i>
                                Predict Health Metrics
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Health Predictions -->
                <div id="healthPredictions" class="card shadow" style="display: none;">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-stethoscope me-2"></i>
                            Health Predictions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <!-- Blood Pressure -->
                            <div class="col-md-6">
                                <div class="prediction-card">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-tachometer-alt text-danger me-2"></i>
                                        <strong>Blood Pressure</strong>
                                    </div>
                                    <div class="prediction-value">
                                        <span id="bloodPressureValue">-- / --</span>
                                        <small class="text-muted">mmHg</small>
                                    </div>
                                    <div class="prediction-category">
                                        <span id="bloodPressureCategory" class="badge">--</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Glucose -->
                            <div class="col-md-6">
                                <div class="prediction-card">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-vial text-warning me-2"></i>
                                        <strong>Glucose</strong>
                                    </div>
                                    <div class="prediction-value">
                                        <span id="glucoseValue">--</span>
                                        <small class="text-muted">mg/dL</small>
                                    </div>
                                    <div class="prediction-category">
                                        <span id="glucoseCategory" class="badge">--</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Cholesterol -->
                            <div class="col-md-6">
                                <div class="prediction-card">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-pills text-info me-2"></i>
                                        <strong>Cholesterol</strong>
                                    </div>
                                    <div class="prediction-value">
                                        <span id="cholesterolValue">--</span>
                                        <small class="text-muted">mg/dL</small>
                                    </div>
                                    <div class="prediction-category">
                                        <span id="cholesterolCategory" class="badge">--</span>
                                    </div>
                                </div>
                            </div>

                            <!-- CV Risk -->
                            <div class="col-md-6">
                                <div class="prediction-card">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-heart text-danger me-2"></i>
                                        <strong>CV Risk Score</strong>
                                    </div>
                                    <div class="prediction-value">
                                        <span id="cvRiskValue">--</span>
                                        <small class="text-muted">/ 100</small>
                                    </div>
                                    <div class="prediction-category">
                                        <span id="cvRiskCategory" class="badge">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 text-center">
                            <button id="newSessionBtn" class="btn btn-outline-primary">
                                <i class="fas fa-plus me-2"></i>
                                Start New Session
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-4">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5 id="loadingText">Processing...</h5>
                    <p class="text-muted mb-0" id="loadingSubtext">Please wait while we analyze your data</p>
                    <div class="mt-3">
                        <button type="button" class="btn btn-sm btn-secondary" onclick="window.ppgApp.forceCloseModal()">
                            <small>Close if stuck</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="errorToast" class="toast align-items-center text-white bg-danger border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body" id="errorMessage">
                    Error message here
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <!-- Success Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body" id="successMessage">
                    Success message here
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>